![DareBox Logo](./carbon.svg)

DareBox _(dárɛ box)_ is a pre provisioned LAMP vagrant box in the vein of [scotchbox](scotchbox.io), but up to date.

__________
> # This is a Work in Progress / Test.
> ## No garauntees this will work , continue being supported, updated etc. At this time it is purely a test to gain understanding of how vagrant and packer works.
__________


# What is included

| Item | Version | Notes |
| ---- | ------- | ----- |
| Kernel | 5.4.0 | |
| Ubuntu | 20.04.4 | current LTS |
| VBoxService | 6.1.30 | |
| php | 7.4.28 | |
| node | 16.14.0 | 12, 14 also installed via nvm |
| npm | 8.3.1 | |
| python3 | 3.8.10 | |
| pip3 | 20.0.2 | |
| rustc | 1.58.1 | |
| cargo | 1.58.0 | |
| git | 2.25.1 | |
| mysql | 10.3.32 | miriaDB |
| searchd | 2.2.11 | sphinx |
| apache2 | 2.4.41 | |
| imagemagick | 6.9.10 | |
| ffmpeg | 4.2.4 | | 

  
# How to use

The vagrant base box is uploaded on vagrant cloud's box repository. You can see it [here](https://app.vagrantup.com/zwrawr/boxes/DareBox). To use it you just need to add it into your 'VagrantFile'.

```ruby
Vagrant.configure("2") do |config|
	config.vm.box = "zwrawr/DareBox"
	config.vm.box_version = "0.0.8"
end
```

# How to develop
## Prerequisite
 - System set up for vitualisation
 - Virtual Box
 - Vagrant
 - Packer

## Cloning the Repo
1. Clone this repo from github. 
2. Run `./darebox.sh build`, this will take a while (10 mins)
3. In your project's Vagrantfile add `/path/to/cloned/repo/output-darebox/package.box` as your source box.  
4. You need to add a file called `vars.pkvars.hcl` and add the following to get packer to run fully.
   ```
   apikey = "#######################################################"
   ```
## Tips
* When packer encounters an error with Vagrant and Virtual Box, It often gives very vague error messages that have nothing to do with the actual error. This can be improved by setting the `PACKER_LOG=1` enviroment varible.

* If you have a built box (`package.box`) in build directory `output-darebox` then you can cd into `test` and launch the test VM. You can then `vagrant ssh` and poke around the VM to check stuff.

## Building and Testing

```
./darebox.sh <command>

        build - Runs packer build generating a provisioned vagrant box 
        test - Runs our custom shell script to see if everything installed correctly
        all - Runs build then test
        clean - Removes build and test artifacts after shuting vms down
        help - Print this info
```

## Layout

* **`scripts/`** Scripts used to provision the vm and are called by packer based on there inclusion in `darebox.pkr.hcl`. These are the most important part.
  * **`motd/`** Files defining the custom message of the day and are copied by the `motd.sh` script.
* **`test/`** Test vagrant setup. Nothing in here contributes to building or configuring darebox.
  * **`test.sh`** Checks that the programs we want are installed.
  * **`versions.csv`** List of program versions generated by the `test.sh` script.
* **`darebox.sh`** Simple build and test runner.
* **`darebox.pkr.hcl`** Packer configuration
* **`Vagrantfile`** The base vagrant config that the box will be based upon
